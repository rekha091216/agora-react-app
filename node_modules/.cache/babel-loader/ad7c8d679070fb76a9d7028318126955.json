{"ast":null,"code":"import { useState, useEffect } from 'react';\nimport AgoraRTC from 'agora-rtc-sdk-ng';\nexport default function useAgora(client) {\n  const [localVideoTrack, setLocalVideoTrack] = useState(undefined);\n  const [localAudioTrack, setLocalAudioTrack] = useState(undefined);\n  const [joinState, setJoinState] = useState(false);\n  const [remoteUsers, setRemoteUsers] = useState([]);\n\n  async function createLocalTracks(audioConfig, videoConfig) {\n    const [microphoneTrack, cameraTrack] = await AgoraRTC.createMicrophoneAndCameraTracks(audioConfig, videoConfig);\n    setLocalAudioTrack(microphoneTrack);\n    setLocalVideoTrack(cameraTrack);\n    return [microphoneTrack, cameraTrack];\n  }\n\n  async function join(appid, channel, token, uid) {\n    if (!client) return;\n    const [microphoneTrack, cameraTrack] = await createLocalTracks();\n    await client.join(appid, channel, token || null);\n    await client.publish([microphoneTrack, cameraTrack]);\n    window.client = client;\n    window.videoTrack = cameraTrack;\n    setJoinState(true);\n  }\n\n  async function leave() {\n    if (localAudioTrack) {\n      localAudioTrack.stop();\n      localAudioTrack.close();\n    }\n\n    if (localVideoTrack) {\n      localVideoTrack.stop();\n      localVideoTrack.close();\n    }\n\n    setRemoteUsers([]);\n    setJoinState(false);\n    await (client === null || client === void 0 ? void 0 : client.leave());\n  }\n\n  useEffect(() => {\n    if (!client) return;\n    setRemoteUsers(client.remoteUsers);\n\n    const handleUserPublished = async (user, mediaType) => {\n      await client.subscribe(user, mediaType); // toggle rerender while state of remoteUsers changed.\n\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    };\n\n    const handleUserUnpublished = user => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    };\n\n    const handleUserJoined = user => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    };\n\n    const handleUserLeft = user => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    };\n\n    client.on('user-published', handleUserPublished);\n    client.on('user-unpublished', handleUserUnpublished);\n    client.on('user-joined', handleUserJoined);\n    client.on('user-left', handleUserLeft);\n    return () => {\n      client.off('user-published', handleUserPublished);\n      client.off('user-unpublished', handleUserUnpublished);\n      client.off('user-joined', handleUserJoined);\n      client.off('user-left', handleUserLeft);\n    };\n  }, [client]);\n  return {\n    localAudioTrack,\n    localVideoTrack,\n    joinState,\n    leave,\n    join,\n    remoteUsers\n  };\n}","map":{"version":3,"sources":["/Users/rekhab/Downloads/ReactDemo/src/hooks/useAgora.tsx"],"names":["useState","useEffect","AgoraRTC","useAgora","client","localVideoTrack","setLocalVideoTrack","undefined","localAudioTrack","setLocalAudioTrack","joinState","setJoinState","remoteUsers","setRemoteUsers","createLocalTracks","audioConfig","videoConfig","microphoneTrack","cameraTrack","createMicrophoneAndCameraTracks","join","appid","channel","token","uid","publish","window","videoTrack","leave","stop","close","handleUserPublished","user","mediaType","subscribe","Array","from","handleUserUnpublished","handleUserJoined","handleUserLeft","on","off"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport AgoraRTC, {\n  IAgoraRTCClient, IAgoraRTCRemoteUser, MicrophoneAudioTrackInitConfig, CameraVideoTrackInitConfig, IMicrophoneAudioTrack, ICameraVideoTrack, ILocalVideoTrack, ILocalAudioTrack } from 'agora-rtc-sdk-ng';\n\nexport default function useAgora(client: IAgoraRTCClient | undefined)\n  :\n   {\n      localAudioTrack: ILocalAudioTrack | undefined,\n      localVideoTrack: ILocalVideoTrack | undefined,\n      joinState: boolean,\n      leave: Function,\n      join: Function,\n      remoteUsers: IAgoraRTCRemoteUser[],\n    }\n    {\n  const [localVideoTrack, setLocalVideoTrack] = useState<ILocalVideoTrack | undefined>(undefined);\n  const [localAudioTrack, setLocalAudioTrack] = useState<ILocalAudioTrack | undefined>(undefined);\n\n  const [joinState, setJoinState] = useState(false);\n\n  const [remoteUsers, setRemoteUsers] = useState<IAgoraRTCRemoteUser[]>([]);\n\n  async function createLocalTracks(audioConfig?: MicrophoneAudioTrackInitConfig, videoConfig?: CameraVideoTrackInitConfig)\n  : Promise<[IMicrophoneAudioTrack, ICameraVideoTrack]> {\n    const [microphoneTrack, cameraTrack] = await AgoraRTC.createMicrophoneAndCameraTracks(audioConfig, videoConfig);\n    setLocalAudioTrack(microphoneTrack);\n    setLocalVideoTrack(cameraTrack);\n    return [microphoneTrack, cameraTrack];\n  }\n\n  async function join(appid: string, channel: string, token?: string, uid?: string | number | null) {\n    if (!client) return;\n    const [microphoneTrack, cameraTrack] = await createLocalTracks();\n    \n    await client.join(appid, channel, token || null);\n    await client.publish([microphoneTrack, cameraTrack]);\n\n    (window as any).client = client;\n    (window as any).videoTrack = cameraTrack;\n\n    setJoinState(true);\n  }\n\n  async function leave() {\n    if (localAudioTrack) {\n      localAudioTrack.stop();\n      localAudioTrack.close();\n    }\n    if (localVideoTrack) {\n      localVideoTrack.stop();\n      localVideoTrack.close();\n    }\n    setRemoteUsers([]);\n    setJoinState(false);\n    await client?.leave();\n  }\n\n  useEffect(() => {\n    if (!client) return;\n    setRemoteUsers(client.remoteUsers);\n\n    const handleUserPublished = async (user: IAgoraRTCRemoteUser, mediaType: 'audio' | 'video') => {\n      await client.subscribe(user, mediaType);\n      // toggle rerender while state of remoteUsers changed.\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    const handleUserUnpublished = (user: IAgoraRTCRemoteUser) => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    const handleUserJoined = (user: IAgoraRTCRemoteUser) => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    const handleUserLeft = (user: IAgoraRTCRemoteUser) => {\n      setRemoteUsers(remoteUsers => Array.from(client.remoteUsers));\n    }\n    client.on('user-published', handleUserPublished);\n    client.on('user-unpublished', handleUserUnpublished);\n    client.on('user-joined', handleUserJoined);\n    client.on('user-left', handleUserLeft);\n\n    return () => {\n      client.off('user-published', handleUserPublished);\n      client.off('user-unpublished', handleUserUnpublished);\n      client.off('user-joined', handleUserJoined);\n      client.off('user-left', handleUserLeft);\n    };\n  }, [client]);\n\n  return {\n    localAudioTrack,\n    localVideoTrack,\n    joinState,\n    leave,\n    join,\n    remoteUsers,\n  };\n}"]},"metadata":{},"sourceType":"module"}